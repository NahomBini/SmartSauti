<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartSauti - NASA Weather Intelligence</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0b3d91 0%, #1a1a2e 100%);
            min-height: 100vh;
            color: #ffffff;
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .nasa-logo {
            font-size: 3.2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .nasa-logo i {
            color: #fc3d21;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        header h1 {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #ffffff, #4fc3f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        header p {
            font-size: 1.3rem;
            opacity: 0.9;
            color: #b3e5fc;
        }

        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 2rem;
            align-items: start;
        }

        .input-section {
            background: rgba(13, 71, 161, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(79, 195, 247, 0.3);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 2rem;
        }

        .section-title {
            color: #4fc3f7;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-buttons {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid rgba(79, 195, 247, 0.3);
        }

        .tab-btn {
            flex: 1;
            padding: 1rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            color: #b3e5fc;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .tab-btn.active {
            border-bottom-color: #fc3d21;
            color: #ffffff;
        }

        .tab-btn:hover {
            color: #ffffff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #b3e5fc;
            font-size: 1.1rem;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 0.75rem;
            background: rgba(13, 71, 161, 0.3);
            border: 1px solid rgba(79, 195, 247, 0.5);
            border-radius: 8px;
            font-size: 1.1rem;
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #fc3d21;
            box-shadow: 0 0 0 2px rgba(252, 61, 33, 0.2);
        }

        .input-group input::placeholder {
            color: #90a4ae;
        }

        .input-group select option {
            background: #0b3d91;
            color: #ffffff;
            padding: 10px;
        }

        .location-search {
            display: flex;
            gap: 0.5rem;
        }

        .location-search input {
            flex: 1;
        }

        .location-search button {
            padding: 0.75rem 1rem;
            background: linear-gradient(45deg, #fc3d21, #ff6d00);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .location-search button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(252, 61, 33, 0.4);
        }

        .suggestions {
            background: rgba(13, 71, 161, 0.9);
            border: 1px solid rgba(79, 195, 247, 0.5);
            border-radius: 5px;
            max-height: 150px;
            overflow-y: auto;
            display: none;
            position: absolute;
            width: calc(100% - 80px);
            z-index: 1000;
        }

        .suggestion-item {
            padding: 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid rgba(79, 195, 247, 0.3);
            color: #ffffff;
            transition: background 0.3s ease;
            font-size: 1rem;
        }

        .suggestion-item:hover {
            background: rgba(79, 195, 247, 0.2);
        }

        .map-container {
            height: 300px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 2px solid rgba(79, 195, 247, 0.5);
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .coordinates-display {
            background: rgba(13, 71, 161, 0.3);
            padding: 0.75rem;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            text-align: center;
            margin-bottom: 1rem;
            color: #4fc3f7;
            border: 1px solid rgba(79, 195, 247, 0.3);
            font-size: 1rem;
        }

        .analyze-btn {
            width: 100%;
            background: linear-gradient(45deg, #fc3d21, #ff6d00);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(252, 61, 33, 0.4);
        }

        .results-area {
            grid-column: 2;
            position: relative;
            min-height: 600px;
        }

        .loading, .error {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            background: rgba(13, 71, 161, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 15px;
            z-index: 10;
            padding: 3rem;
        }

        .loading i {
            font-size: 3rem;
            color: #fc3d21;
            margin-bottom: 1rem;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: rgba(252, 61, 33, 0.1);
            color: #ff8a65;
            border: 1px solid rgba(252, 61, 33, 0.3);
        }

        .error i {
            font-size: 3rem;
            color: #ff8a65;
            margin-bottom: 1rem;
        }

        .results-section {
            background: rgba(13, 71, 161, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(79, 195, 247, 0.3);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            min-height: 600px;
            position: relative;
            z-index: 1;
        }

        .results-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(79, 195, 247, 0.3);
        }

        .results-header h2 {
            color: #4fc3f7;
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }

        .results-header p {
            color: #b3e5fc;
            margin-bottom: 0.25rem;
            font-size: 1.1rem;
        }

        .seasonal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .seasonal-card {
            background: rgba(13, 71, 161, 0.2);
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            transition: all 0.3s ease;
        }

        .seasonal-card:hover {
            transform: translateY(-5px);
            border-color: #fc3d21;
            box-shadow: 0 8px 25px rgba(252, 61, 33, 0.2);
        }

        .seasonal-card h4 {
            color: #4fc3f7;
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1.2rem;
        }

        .seasonal-card p {
            color: #e3f2fd;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .advice-section {
            background: rgba(13, 71, 161, 0.2);
            border: 1px solid rgba(79, 195, 247, 0.3);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .advice-category {
            margin-bottom: 1.5rem;
        }

        .advice-category h4 {
            color: #4fc3f7;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
        }

        .advice-item {
            background: rgba(13, 71, 161, 0.3);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            border-left: 4px solid #4fc3f7;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .advice-item:hover {
            transform: translateX(5px);
            border-left-color: #fc3d21;
        }

        .advice-item.warning {
            border-left-color: #fc3d21;
            background: rgba(252, 61, 33, 0.1);
        }

        .advice-item.info {
            border-left-color: #4fc3f7;
        }

        .advice-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .specific-day-card {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid rgba(255, 152, 0, 0.5);
            border-left: 4px solid #ff9800;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .weather-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .weather-stat {
            text-align: center;
            padding: 1.5rem 1rem;
            background: rgba(13, 71, 161, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            transition: all 0.3s ease;
        }

        .weather-stat:hover {
            transform: translateY(-3px);
            border-color: #fc3d21;
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #4fc3f7;
        }

        .stat-value {
            font-size: 1.6rem;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 1rem;
            color: #b3e5fc;
        }

        .predictions-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
            background: rgba(13, 71, 161, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .predictions-table th,
        .predictions-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(79, 195, 247, 0.3);
            font-size: 1rem;
        }

        .predictions-table th {
            background: rgba(13, 71, 161, 0.3);
            font-weight: 600;
            color: #4fc3f7;
        }

        .predictions-table td {
            color: #e3f2fd;
        }

        .predictions-table tr:hover {
            background: rgba(79, 195, 247, 0.1);
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .action-btn {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #fc3d21, #ff6d00);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(252, 61, 33, 0.4);
        }

        .btn-secondary {
            background: rgba(79, 195, 247, 0.2);
            color: #4fc3f7;
            border: 1px solid rgba(79, 195, 247, 0.5);
        }

        .btn-secondary:hover {
            background: rgba(79, 195, 247, 0.3);
            transform: translateY(-2px);
        }

        .quick-suggestions {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.5);
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
        }

        .suggestion-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 0.75rem;
        }

        .suggestion-tag {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.75rem 1rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 193, 7, 0.5);
            color: #ffd54f;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .suggestion-tag:hover {
            transform: translateY(-2px);
            background: rgba(255, 193, 7, 0.2);
        }

        .no-data {
            color: #90a4ae;
            font-style: italic;
            font-size: 1rem;
        }

        .data-source {
            text-align: center;
            margin-top: 2rem;
            color: #b3e5fc;
            font-size: 1rem;
        }

        .settings-panel {
            background: rgba(13, 71, 161, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(79, 195, 247, 0.3);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-top: 2rem;
        }

        .settings-group {
            margin-bottom: 1.5rem;
        }

        .settings-group h3 {
            color: #4fc3f7;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(79, 195, 247, 0.3);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #fc3d21;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .language-selector {
            width: 100%;
            padding: 0.75rem;
            background: rgba(13, 71, 161, 0.3);
            border: 1px solid rgba(79, 195, 247, 0.5);
            border-radius: 8px;
            font-size: 1.1rem;
            color: #ffffff;
        }

        .settings-btn {
            background: rgba(79, 195, 247, 0.2);
            color: #4fc3f7;
            border: 1px solid rgba(79, 195, 247, 0.5);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            margin-top: 1rem;
            font-size: 1rem;
        }

        .settings-btn:hover {
            background: rgba(79, 195, 247, 0.3);
            transform: translateY(-2px);
        }

        .simplified-mode .results-section {
            background: rgba(255, 255, 255, 0.1);
        }

        .simplified-mode .advice-item {
            background: rgba(255, 255, 255, 0.2);
        }

        .simplified-mode .seasonal-card {
            background: rgba(255, 255, 255, 0.15);
        }

        .simplified-mode .weather-stat {
            background: rgba(255, 255, 255, 0.15);
        }

        .simplified-mode .predictions-table {
            background: rgba(255, 255, 255, 0.1);
        }

        .simplified-mode .quick-suggestions {
            background: rgba(255, 193, 7, 0.2);
        }

        .color-blind-mode .stat-icon {
            color: #ffffff !important;
        }

        .color-blind-mode .advice-item.warning {
            border-left-color: #ffff00 !important;
            background: rgba(255, 255, 0, 0.1) !important;
        }

        .color-blind-mode .seasonal-card {
            border-color: #ffffff !important;
        }

        .color-blind-mode .seasonal-card:hover {
            border-color: #ffff00 !important;
        }

        .color-blind-mode .weather-stat {
            border-color: #ffffff !important;
        }

        .color-blind-mode .weather-stat:hover {
            border-color: #ffff00 !important;
        }

        .color-blind-mode .quick-suggestions {
            border-color: #ffff00 !important;
            background: rgba(255, 255, 0, 0.1) !important;
        }

        .color-blind-mode .suggestion-tag {
            border-color: #ffff00 !important;
            color: #ffff00 !important;
        }

        .color-blind-mode .advice-item {
            border-left-color: #ffffff !important;
        }

        .color-blind-mode .advice-item.info {
            border-left-color: #00ffff !important;
        }

        .color-blind-mode .specific-day-card {
            border-color: #ffff00 !important;
            border-left-color: #ffff00 !important;
        }

        .color-blind-mode .section-title {
            color: #ffff00 !important;
        }

        .color-blind-mode .results-header h2 {
            color: #ffff00 !important;
        }

        .color-blind-mode .advice-category h4 {
            color: #ffff00 !important;
        }

        .color-blind-mode .seasonal-card h4 {
            color: #ffff00 !important;
        }

        .road-conditions {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid rgba(255, 152, 0, 0.5);
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
        }

        .road-condition-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin: 0.5rem 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .road-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .road-status.open {
            background: rgba(76, 175, 80, 0.3);
            color: #4caf50;
        }

        .road-status.closed {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
        }

        .road-status.caution {
            background: rgba(255, 193, 7, 0.3);
            color: #ffc107;
        }

        .color-blind-mode .road-status.open {
            background: rgba(0, 255, 0, 0.3);
            color: #00ff00;
        }

        .color-blind-mode .road-status.closed {
            background: rgba(255, 0, 0, 0.3);
            color: #ff0000;
        }

        .color-blind-mode .road-status.caution {
            background: rgba(255, 255, 0, 0.3);
            color: #ffff00;
        }

        .plant-recommendations {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.5);
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
        }

        .plant-category {
            margin-bottom: 1.5rem;
        }

        .plant-category h4 {
            color: #4caf50;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .plant-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .plant-tag {
            background: rgba(76, 175, 80, 0.2);
            padding: 0.75rem 1rem;
            border-radius: 20px;
            border: 1px solid rgba(76, 175, 80, 0.5);
            color: #a5d6a7;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .color-blind-mode .plant-recommendations {
            border-color: #00ff00 !important;
            background: rgba(0, 255, 0, 0.1) !important;
        }

        .color-blind-mode .plant-category h4 {
            color: #00ff00 !important;
        }

        .color-blind-mode .plant-tag {
            border-color: #00ff00 !important;
            color: #00ff00 !important;
        }

        .probability-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }

        .probability-bar {
            flex: 1;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(45deg, #4fc3f7, #fc3d21);
            border-radius: 5px;
        }

        .color-blind-mode .probability-fill {
            background: linear-gradient(45deg, #ffff00, #ff00ff) !important;
        }

        .tts-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .tts-btn {
            background: rgba(79, 195, 247, 0.2);
            color: #4fc3f7;
            border: 1px solid rgba(79, 195, 247, 0.5);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .tts-btn:hover {
            background: rgba(79, 195, 247, 0.3);
        }

        .color-blind-mode .tts-btn {
            border-color: #ffffff !important;
            color: #ffffff !important;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                position: static;
            }
            
            .results-area {
                grid-column: 1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .weather-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .suggestion-items {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="nasa-logo">
                <i class="fas fa-satellite"></i>
                <span>NASA</span>
            </div>
            <h1>SmartSauti - Weather Intelligence Platform</h1>
            <p>Powered by NASA Earth Observation Data</p>
        </header>

        <div class="main-content">
            <div class="input-section">
                <div class="section-title">
                    <i class="fas fa-map-marker-alt"></i>
                    Location Selection
                </div>

                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="location-search">
                        <i class="fas fa-search"></i> Search
                    </button>
                    <button class="tab-btn" data-tab="map-select">
                        <i class="fas fa-globe-americas"></i> Map
                    </button>
                </div>

                <div id="location-search" class="tab-content active">
                    <div class="input-group">
                        <label for="locationInput">Enter Location:</label>
                        <div class="location-search">
                            <input type="text" id="locationInput" placeholder="City, country, or coordinates...">
                            <button id="searchLocationBtn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <div id="locationSuggestions" class="suggestions"></div>
                    </div>

                    <div class="coordinates-display">
                        <i class="fas fa-crosshairs"></i>
                        Lat: <span id="displayLat">-1.2921</span>, 
                        Lon: <span id="displayLon">36.8219</span>
                    </div>
                </div>

                <div id="map-select" class="tab-content">
                    <div class="input-group">
                        <label>Select on Map:</label>
                        <div class="map-container">
                            <div id="map"></div>
                        </div>
                    </div>

                    <div class="coordinates-display">
                        <i class="fas fa-map-pin"></i>
                        Selected: Lat: <span id="mapLat">-1.2921</span>, 
                        Lon: <span id="mapLon">36.8219</span>
                    </div>
                </div>

                <div class="section-title">
                    <i class="fas fa-sliders-h"></i>
                    Analysis Parameters
                </div>

                <div class="input-group">
                    <label for="userType">
                        <i class="fas fa-user"></i> User Profile
                    </label>
                    <select id="userType">
                        <option value="farmer">ðŸŒ± Farmer</option>
                        <option value="driver">ðŸš— Driver</option>
                        <option value="event_organizer">ðŸŽª Event Organizer</option>
                        <option value="general">ðŸ‘¤ General User</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="days">
                        <i class="fas fa-calendar-alt"></i> Forecast Period
                    </label>
                    <select id="days">
                        <option value="30">30 days</option>
                        <option value="90">90 days</option>
                        <option value="365" selected>1 year</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="specificDate">
                        <i class="fas fa-calendar-day"></i> Specific Date
                    </label>
                    <input type="date" id="specificDate">
                    <small style="color: #90a4ae; font-size: 0.9rem;">Optional: Leave empty for general forecast</small>
                </div>

                <button id="analyzeBtn" class="analyze-btn">
                    <i class="fas fa-rocket"></i>
                    Launch Analysis
                </button>

                <div class="settings-panel">
                    <div class="section-title">
                        <i class="fas fa-cog"></i>
                        Settings
                    </div>

                    <div class="settings-group">
                        <h3><i class="fas fa-eye"></i> Accessibility</h3>
                        
                        <div class="toggle-label">
                            <span>Simplified Mode</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="simplifiedMode">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="toggle-label">
                            <span>Color Blind Mode</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="colorBlindMode">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="toggle-label">
                            <span>Text-to-Speech</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="ttsMode">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3><i class="fas fa-language"></i> Language</h3>
                        <select id="languageSelect" class="language-selector">
                            <option value="en">English</option>
                            <option value="es">EspaÃ±ol</option>
                            <option value="fr">FranÃ§ais</option>
                            <option value="sw">Kiswahili</option>
                            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                        </select>
                    </div>

                    <button id="applySettings" class="settings-btn">
                        <i class="fas fa-check"></i> Apply Settings
                    </button>
                </div>

                <div class="data-source">
                    <i class="fas fa-database"></i>
                    Data Source: NASA POWER API
                </div>
            </div>

            <div class="results-area">
                <div id="loading" class="loading" style="display: none;">
                    <i class="fas fa-satellite"></i>
                    <h3>Connecting to NASA Satellites...</h3>
                    <p>Processing Earth observation data...</p>
                </div>

                <div id="error" class="error" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Signal Lost</h3>
                    <p id="errorMessage"></p>
                </div>

                <div id="results" class="results-section" style="display: none;">
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        class NASAWeatherApp {
            constructor() {
                this.map = null;
                this.marker = null;
                this.currentLat = -1.2921;
                this.currentLon = 36.8219;
                this.currentData = null;
                this.settings = {
                    simplifiedMode: false,
                    colorBlindMode: false,
                    ttsMode: false,
                    language: 'en'
                };
                
                this.weatherIcons = {
                    temperature: 'fas fa-thermometer-half',
                    precipitation: 'fas fa-cloud-rain',
                    wind_speed: 'fas fa-wind',
                    humidity: 'fas fa-tint',
                    max_temperature: 'fas fa-temperature-high',
                    min_temperature: 'fas fa-temperature-low'
                };
                
                this.translations = {
                    en: {
                        title: "Weather Intelligence Report",
                        coordinates: "Coordinates",
                        analysisTime: "Analysis Time",
                        targetDate: "Target Date",
                        dataType: "Data Type",
                        temperature: "Temperature",
                        precipitation: "Precipitation",
                        windSpeed: "Wind Speed",
                        humidity: "Humidity",
                        maxTemp: "Max Temp",
                        minTemp: "Min Temp",
                        seasonalOutlook: "Seasonal Climate Outlook",
                        avgTemp: "Avg Temp",
                        totalRain: "Total Rain",
                        rainyDays: "Rainy Days",
                        immediateActions: "Immediate Actions",
                        seasonalPlanning: "Seasonal Planning",
                        dayForecast: "Day Forecast",
                        date: "Date",
                        rain: "Rain",
                        wind: "Wind",
                        downloadReport: "Download Report",
                        newAnalysis: "New Analysis",
                        farmingRecs: "Farming Recommendations",
                        drivingTips: "Driving Safety Tips",
                        eventPlanning: "Event Planning Advice",
                        smartRecs: "Smart Recommendations",
                        roadConditions: "Road Conditions",
                        plantRecommendations: "Plant Recommendations",
                        probabilityOfRain: "Probability of Rain",
                        readAloud: "Read Aloud",
                        stopReading: "Stop Reading"
                    },
                    es: {
                        title: "Informe de Inteligencia MeteorolÃ³gica",
                        coordinates: "Coordenadas",
                        analysisTime: "Tiempo de AnÃ¡lisis",
                        targetDate: "Fecha Objetivo",
                        dataType: "Tipo de Datos",
                        temperature: "Temperatura",
                        precipitation: "PrecipitaciÃ³n",
                        windSpeed: "Velocidad del Viento",
                        humidity: "Humedad",
                        maxTemp: "Temp MÃ¡x",
                        minTemp: "Temp MÃ­n",
                        seasonalOutlook: "Perspectiva ClimÃ¡tica Estacional",
                        avgTemp: "Temp Prom",
                        totalRain: "Lluvia Total",
                        rainyDays: "DÃ­as Lluviosos",
                        immediateActions: "Acciones Inmediatas",
                        seasonalPlanning: "PlanificaciÃ³n Estacional",
                        dayForecast: "PronÃ³stico Diario",
                        date: "Fecha",
                        rain: "Lluvia",
                        wind: "Viento",
                        downloadReport: "Descargar Informe",
                        newAnalysis: "Nuevo AnÃ¡lisis",
                        farmingRecs: "Recomendaciones AgrÃ­colas",
                        drivingTips: "Consejos de ConducciÃ³n Segura",
                        eventPlanning: "Consejos para PlanificaciÃ³n de Eventos",
                        smartRecs: "Recomendaciones Inteligentes",
                        roadConditions: "Condiciones de Carreteras",
                        plantRecommendations: "Recomendaciones de Plantas",
                        probabilityOfRain: "Probabilidad de Lluvia",
                        readAloud: "Leer en Voz Alta",
                        stopReading: "Detener Lectura"
                    },
                    fr: {
                        title: "Rapport d'Intelligence MÃ©tÃ©orologique",
                        coordinates: "CoordonnÃ©es",
                        analysisTime: "Heure d'Analyse",
                        targetDate: "Date Cible",
                        dataType: "Type de DonnÃ©es",
                        temperature: "TempÃ©rature",
                        precipitation: "PrÃ©cipitation",
                        windSpeed: "Vitesse du Vent",
                        humidity: "HumiditÃ©",
                        maxTemp: "Temp Max",
                        minTemp: "Temp Min",
                        seasonalOutlook: "Perspective Climatique SaisonniÃ¨re",
                        avgTemp: "Temp Moy",
                        totalRain: "Pluie Totale",
                        rainyDays: "Jours de Pluie",
                        immediateActions: "Actions ImmÃ©diates",
                        seasonalPlanning: "Planification SaisonniÃ¨re",
                        dayForecast: "PrÃ©vision Quotidienne",
                        date: "Date",
                        rain: "Pluie",
                        wind: "Vent",
                        downloadReport: "TÃ©lÃ©charger le Rapport",
                        newAnalysis: "Nouvelle Analyse",
                        farmingRecs: "Recomendations Agricoles",
                        drivingTips: "Conseils de Conduite SÃ©curitaire",
                        eventPlanning: "Conseils pour la Planification d'Ã‰vÃ©nements",
                        smartRecs: "Recommandations Intelligentes",
                        roadConditions: "Conditions RoutiÃ¨res",
                        plantRecommendations: "Recommandations de Plantes",
                        probabilityOfRain: "ProbabilitÃ© de Pluie",
                        readAloud: "Lire Ã  Haute Voix",
                        stopReading: "ArrÃªter la Lecture"
                    },
                    sw: {
                        title: "Ripoti ya Ufahamu wa Hali ya Hewa",
                        coordinates: "Kuratibu",
                        analysisTime: "Muda wa Uchambuzi",
                        targetDate: "Tarehe Lengwa",
                        dataType: "Aina ya Data",
                        temperature: "Joto",
                        precipitation: "Mvua",
                        windSpeed: "Kasi ya Upepo",
                        humidity: "Unyevu",
                        maxTemp: "Joto la Juu",
                        minTemp: "Joto la Chini",
                        seasonalOutlook: "Mtazamo wa Hali ya Hewa ya Msimu",
                        avgTemp: "Joto la Wastani",
                        totalRain: "Mvua Jumla",
                        rainyDays: "Siku za Mvua",
                        immediateActions: "Hatua za Haraka",
                        seasonalPlanning: "Mipango ya Msimu",
                        dayForecast: "Utabiri wa Siku",
                        date: "Tarehe",
                        rain: "Mvua",
                        wind: "Upepo",
                        downloadReport: "Pakua Ripoti",
                        newAnalysis: "Uchambuzi Mpya",
                        farmingRecs: "Mapendekezo ya Kilimo",
                        drivingTips: "Vidokezo vya Usalama wa Kuendesha Gari",
                        eventPlanning: "Ushauri wa Kupanga Matukio",
                        smartRecs: "Mapendekezo ya Kisasa",
                        roadConditions: "Hali ya Barabara",
                        plantRecommendations: "Mapendekezo ya Mimea",
                        probabilityOfRain: "Uwezekano wa Mvua",
                        readAloud: "Soma Kwa Sauti",
                        stopReading: "Acha Kusoma"
                    },
                    ar: {
                        title: "ØªÙ‚Ø±ÙŠØ± Ø°ÙƒØ§Ø¡ Ø§Ù„Ø·Ù‚Ø³",
                        coordinates: "Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª",
                        analysisTime: "ÙˆÙ‚Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„",
                        targetDate: "Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù",
                        dataType: "Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
                        temperature: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©",
                        precipitation: "Ù‡Ø·ÙˆÙ„ Ø§Ù„Ø£Ù…Ø·Ø§Ø±",
                        windSpeed: "Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­",
                        humidity: "Ø§Ù„Ø±Ø·ÙˆØ¨Ø©",
                        maxTemp: "Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©",
                        minTemp: "Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©",
                        seasonalOutlook: "ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø® Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ©",
                        avgTemp: "Ù…ØªÙˆØ³Ø· Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©",
                        totalRain: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù…Ø·Ø§Ø±",
                        rainyDays: "Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù…Ø·Ø±Ø©",
                        immediateActions: "Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ©",
                        seasonalPlanning: "Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ÙˆØ³Ù…ÙŠ",
                        dayForecast: "ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…",
                        date: "Ø§Ù„ØªØ§Ø±ÙŠØ®",
                        rain: "Ø§Ù„Ù…Ø·Ø±",
                        wind: "Ø§Ù„Ø±ÙŠØ§Ø­",
                        downloadReport: "ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±",
                        newAnalysis: "ØªØ­Ù„ÙŠÙ„ Ø¬Ø¯ÙŠØ¯",
                        farmingRecs: "ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø²Ø±Ø§Ø¹Ø©",
                        drivingTips: "Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¢Ù…Ù†Ø©",
                        eventPlanning: "Ù†ØµØ§Ø¦Ø­ ØªØ®Ø·ÙŠØ· Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª",
                        smartRecs: "ØªÙˆØµÙŠØ§Øª Ø°ÙƒÙŠØ©",
                        roadConditions: "Ø¸Ø±ÙˆÙ Ø§Ù„Ø·Ø±ÙŠÙ‚",
                        plantRecommendations: "ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª",
                        probabilityOfRain: "Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ù‡Ø·ÙˆÙ„ Ø§Ù„Ø£Ù…Ø·Ø§Ø±",
                        readAloud: "Ù‚Ø±Ø§Ø¡Ø© Ø¨ØµÙˆØª Ø¹Ø§Ù„",
                        stopReading: "Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©"
                    }
                };
                
                this.initializeApp();
            }
            
            initializeApp() {
                this.initializeMap();
                this.initializeEventListeners();
                this.initializeTabs();
                this.loadSettings();
            }
            
            initializeMap() {
                this.map = L.map('map').setView([this.currentLat, this.currentLon], 10);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap contributors'
                }).addTo(this.map);
                
                this.marker = L.marker([this.currentLat, this.currentLon], {
                    draggable: true
                }).addTo(this.map);
                
                this.marker.on('dragend', (e) => {
                    const position = this.marker.getLatLng();
                    this.updateCoordinates(position.lat, position.lng);
                });
                
                this.map.on('click', (e) => {
                    this.marker.setLatLng(e.latlng);
                    this.updateCoordinates(e.latlng.lat, e.latlng.lng);
                });
            }
            
            initializeEventListeners() {
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchTab(e.target.getAttribute('data-tab'));
                    });
                });
                
                document.getElementById('searchLocationBtn').addEventListener('click', () => {
                    this.searchLocation();
                });
                
                document.getElementById('locationInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.searchLocation();
                    }
                });
                
                document.getElementById('locationInput').addEventListener('input', (e) => {
                    this.handleLocationInput(e.target.value);
                });
                
                document.getElementById('analyzeBtn').addEventListener('click', () => {
                    this.analyzeWeather();
                });
                
                document.getElementById('applySettings').addEventListener('click', () => {
                    this.applySettings();
                });
            }
            
            initializeTabs() {
                this.switchTab('location-search');
            }
            
            loadSettings() {
                const savedSettings = localStorage.getItem('nasaWeatherSettings');
                if (savedSettings) {
                    this.settings = JSON.parse(savedSettings);
                    this.updateSettingsUI();
                }
            }
            
            saveSettings() {
                localStorage.setItem('nasaWeatherSettings', JSON.stringify(this.settings));
            }
            
            updateSettingsUI() {
                document.getElementById('simplifiedMode').checked = this.settings.simplifiedMode;
                document.getElementById('colorBlindMode').checked = this.settings.colorBlindMode;
                document.getElementById('ttsMode').checked = this.settings.ttsMode;
                document.getElementById('languageSelect').value = this.settings.language;
                
                this.applyAccessibilityModes();
            }
            
            applySettings() {
                this.settings.simplifiedMode = document.getElementById('simplifiedMode').checked;
                this.settings.colorBlindMode = document.getElementById('colorBlindMode').checked;
                this.settings.ttsMode = document.getElementById('ttsMode').checked;
                this.settings.language = document.getElementById('languageSelect').value;
                
                this.saveSettings();
                this.applyAccessibilityModes();
                
                alert(this.translate("Settings applied successfully!"));
            }
            
            applyAccessibilityModes() {
                const body = document.body;
                
                if (this.settings.simplifiedMode) {
                    body.classList.add('simplified-mode');
                } else {
                    body.classList.remove('simplified-mode');
                }
                
                if (this.settings.colorBlindMode) {
                    body.classList.add('color-blind-mode');
                } else {
                    body.classList.remove('color-blind-mode');
                }
            }
            
            translate(key) {
                return this.translations[this.settings.language][key] || this.translations.en[key] || key;
            }
            
            switchTab(tabName) {
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabName).classList.add('active');
            }
            
            async searchLocation() {
                const locationInput = document.getElementById('locationInput').value.trim();
                
                if (!locationInput) {
                    this.showError('Please enter a location name');
                    return;
                }
                
                this.showLoading('Searching for location...');
                
                try {
                    // RESTORED: Proper location mapping with more countries
                    const locationMap = {
                        'nairobi': { lat: -1.2921, lon: 36.8219, address: 'Nairobi, Kenya' },
                        'kenya': { lat: -1.2921, lon: 36.8219, address: 'Kenya' },
                        'cairo': { lat: 30.0444, lon: 31.2357, address: 'Cairo, Egypt' },
                        'egypt': { lat: 30.0444, lon: 31.2357, address: 'Egypt' },
                        'lagos': { lat: 6.5244, lon: 3.3792, address: 'Lagos, Nigeria' },
                        'nigeria': { lat: 6.5244, lon: 3.3792, address: 'Nigeria' },
                        'johannesburg': { lat: -26.2041, lon: 28.0473, address: 'Johannesburg, South Africa' },
                        'south africa': { lat: -26.2041, lon: 28.0473, address: 'South Africa' },
                        'accra': { lat: 5.6037, lon: -0.1870, address: 'Accra, Ghana' },
                        'ghana': { lat: 5.6037, lon: -0.1870, address: 'Ghana' },
                        'dar es salaam': { lat: -6.7924, lon: 39.2083, address: 'Dar es Salaam, Tanzania' },
                        'tanzania': { lat: -6.7924, lon: 39.2083, address: 'Tanzania' },
                        'kampala': { lat: 0.3476, lon: 32.5825, address: 'Kampala, Uganda' },
                        'uganda': { lat: 0.3476, lon: 32.5825, address: 'Uganda' },
                        'addis ababa': { lat: 9.0320, lon: 38.7460, address: 'Addis Ababa, Ethiopia' },
                        'ethiopia': { lat: 9.0320, lon: 38.7460, address: 'Ethiopia' },
                        'united states': { lat: 39.8283, lon: -98.5795, address: 'United States' },
                        'usa': { lat: 39.8283, lon: -98.5795, address: 'United States' },
                        'new york': { lat: 40.7128, lon: -74.0060, address: 'New York, USA' },
                        'london': { lat: 51.5074, lon: -0.1278, address: 'London, UK' },
                        'paris': { lat: 48.8566, lon: 2.3522, address: 'Paris, France' },
                        'tokyo': { lat: 35.6762, lon: 139.6503, address: 'Tokyo, Japan' },
                        'mumbai': { lat: 19.0760, lon: 72.8777, address: 'Mumbai, India' },
                        'sydney': { lat: -33.8688, lon: 151.2093, address: 'Sydney, Australia' },
                        'brazil': { lat: -14.2350, lon: -51.9253, address: 'Brazil' },
                        'china': { lat: 35.8617, lon: 104.1954, address: 'China' },
                        'russia': { lat: 61.5240, lon: 105.3188, address: 'Russia' },
                        'canada': { lat: 56.1304, lon: -106.3468, address: 'Canada' }
                    };
                    
                    // Find the best matching location
                    const searchTerm = locationInput.toLowerCase();
                    let foundLocation = null;
                    
                    for (const [key, location] of Object.entries(locationMap)) {
                        if (searchTerm.includes(key)) {
                            foundLocation = location;
                            break;
                        }
                    }
                    
                    if (foundLocation) {
                        this.updateCoordinates(foundLocation.lat, foundLocation.lon);
                        this.updateMapView(foundLocation.lat, foundLocation.lon);
                        this.hideLoading();
                        document.getElementById('locationInput').value = foundLocation.address;
                    } else {
                        // If no specific match found, use a default location based on the input
                        const defaultLocations = {
                            'united': { lat: 39.8283, lon: -98.5795, address: 'United States' },
                            'europe': { lat: 54.5260, lon: 15.2551, address: 'Europe' },
                            'asia': { lat: 34.0479, lon: 100.6197, address: 'Asia' },
                            'africa': { lat: 8.7832, lon: 34.5085, address: 'Africa' },
                            'america': { lat: 39.8283, lon: -98.5795, address: 'North America' }
                        };
                        
                        let defaultLocation = null;
                        for (const [key, loc] of Object.entries(defaultLocations)) {
                            if (searchTerm.includes(key)) {
                                defaultLocation = loc;
                                break;
                            }
                        }
                        
                        if (defaultLocation) {
                            this.updateCoordinates(defaultLocation.lat, defaultLocation.lon);
                            this.updateMapView(defaultLocation.lat, defaultLocation.lon);
                            this.hideLoading();
                            document.getElementById('locationInput').value = defaultLocation.address;
                        } else {
                            // Fallback to Nairobi
                            this.updateCoordinates(-1.2921, 36.8219);
                            this.updateMapView(-1.2921, 36.8219);
                            this.hideLoading();
                            document.getElementById('locationInput').value = 'Nairobi, Kenya';
                        }
                    }
                    
                } catch (error) {
                    this.showError('Geocoding service error: ' + error.message);
                }
            }
            
            async handleLocationInput(query) {
                if (query.length < 3) {
                    document.getElementById('locationSuggestions').style.display = 'none';
                    return;
                }
                
                const commonLocations = {
                    'Nairobi, Kenya': [-1.2921, 36.8219],
                    'Cairo, Egypt': [30.0444, 31.2357],
                    'Lagos, Nigeria': [6.5244, 3.3792],
                    'Johannesburg, South Africa': [-26.2041, 28.0473],
                    'Accra, Ghana': [5.6037, -0.1870],
                    'Dar es Salaam, Tanzania': [-6.7924, 39.2083],
                    'Kampala, Uganda': [0.3476, 32.5825],
                    'Addis Ababa, Ethiopia': [9.0320, 38.7460],
                    'New York, USA': [40.7128, -74.0060],
                    'London, UK': [51.5074, -0.1278],
                    'Paris, France': [48.8566, 2.3522],
                    'Tokyo, Japan': [35.6762, 139.6503],
                    'Mumbai, India': [19.0760, 72.8777],
                    'Sydney, Australia': [-33.8688, 151.2093]
                };
                
                const suggestions = Object.keys(commonLocations)
                    .filter(loc => loc.toLowerCase().includes(query.toLowerCase()))
                    .slice(0, 5);
                
                const suggestionsDiv = document.getElementById('locationSuggestions');
                suggestionsDiv.innerHTML = '';
                
                if (suggestions.length > 0) {
                    suggestions.forEach(location => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        div.textContent = location;
                        div.addEventListener('click', () => {
                            document.getElementById('locationInput').value = location;
                            suggestionsDiv.style.display = 'none';
                            this.searchLocation();
                        });
                        suggestionsDiv.appendChild(div);
                    });
                    suggestionsDiv.style.display = 'block';
                } else {
                    suggestionsDiv.style.display = 'none';
                }
            }
            
            updateCoordinates(lat, lon) {
                this.currentLat = lat;
                this.currentLon = lon;
                
                // FIXED: Format coordinates to 1 decimal place
                document.getElementById('displayLat').textContent = lat.toFixed(1);
                document.getElementById('displayLon').textContent = lon.toFixed(1);
                document.getElementById('mapLat').textContent = lat.toFixed(1);
                document.getElementById('mapLon').textContent = lon.toFixed(1);
            }
            
            updateMapView(lat, lon) {
                this.map.setView([lat, lon], 10);
                this.marker.setLatLng([lat, lon]);
            }
            
            async analyzeWeather() {
                const userType = document.getElementById('userType').value;
                const days = document.getElementById('days').value;
                const specificDate = document.getElementById('specificDate').value;
                
                this.showLoading('Analyzing satellite data...');
                
                try {
                    setTimeout(() => {
                        const mockData = this.generateMockWeatherData(userType, specificDate);
                        this.currentData = mockData;
                        this.displayResults(mockData, specificDate);
                    }, 2000);
                    
                } catch (error) {
                    this.showError('Network communication error: ' + error.message);
                }
            }
            
            generateMockWeatherData(userType, specificDate = null) {
                const baseData = {
                    success: true,
                    location: {
                        lat: this.currentLat,
                        lon: this.currentLon,
                        address: document.getElementById('locationInput').value || 'Nairobi, Kenya'
                    },
                    generated_at: new Date().toISOString(),
                    user_advice: {
                        immediate: [
                            "Monitor weather updates regularly",
                            "Plan outdoor activities during favorable conditions",
                            "Stay hydrated and protect yourself from extreme weather"
                        ],
                        seasonal: [
                            "Consider long-term climate patterns for planning",
                            "Prepare for seasonal variations in temperature and precipitation"
                        ],
                        specific_day: [
                            "Check real-time updates for accurate planning",
                            "Have contingency plans for unexpected weather changes"
                        ]
                    }
                };
                
                if (specificDate) {
                    baseData.date = specificDate;
                    baseData.data = {
                        is_prediction: new Date(specificDate) > new Date(),
                        data: {
                            // FIXED: Format all numbers to 1 decimal place
                            temperature: parseFloat((22 + Math.random() * 10).toFixed(1)),
                            precipitation: parseFloat((Math.random() * 15).toFixed(1)),
                            wind_speed: parseFloat((3 + Math.random() * 10).toFixed(1)),
                            humidity: parseFloat((40 + Math.random() * 40).toFixed(1)),
                            max_temperature: parseFloat((25 + Math.random() * 8).toFixed(1)),
                            min_temperature: parseFloat((15 + Math.random() * 5).toFixed(1))
                        }
                    };
                } else {
                    baseData.seasonal_forecast = {
                        "Spring": {
                            // FIXED: Format all numbers to 1 decimal place
                            avg_temperature: parseFloat((20 + Math.random() * 8).toFixed(1)),
                            total_precipitation: parseFloat((50 + Math.random() * 100).toFixed(1)),
                            days_with_rain: Math.floor(10 + Math.random() * 20),
                            max_temperature: parseFloat((25 + Math.random() * 10).toFixed(1)),
                            min_temperature: parseFloat((15 + Math.random() * 5).toFixed(1))
                        },
                        "Summer": {
                            avg_temperature: parseFloat((25 + Math.random() * 10).toFixed(1)),
                            total_precipitation: parseFloat((30 + Math.random() * 80).toFixed(1)),
                            days_with_rain: Math.floor(5 + Math.random() * 15),
                            max_temperature: parseFloat((30 + Math.random() * 12).toFixed(1)),
                            min_temperature: parseFloat((18 + Math.random() * 7).toFixed(1))
                        },
                        "Autumn": {
                            avg_temperature: parseFloat((18 + Math.random() * 6).toFixed(1)),
                            total_precipitation: parseFloat((60 + Math.random() * 90).toFixed(1)),
                            days_with_rain: Math.floor(12 + Math.random() * 18),
                            max_temperature: parseFloat((22 + Math.random() * 8).toFixed(1)),
                            min_temperature: parseFloat((12 + Math.random() * 6).toFixed(1))
                        },
                        "Winter": {
                            avg_temperature: parseFloat((12 + Math.random() * 8).toFixed(1)),
                            total_precipitation: parseFloat((40 + Math.random() * 70).toFixed(1)),
                            days_with_rain: Math.floor(8 + Math.random() * 15),
                            max_temperature: parseFloat((16 + Math.random() * 6).toFixed(1)),
                            min_temperature: parseFloat((8 + Math.random() * 4).toFixed(1))
                        }
                    };
                    
                    baseData.predictions = [];
                    for (let i = 0; i < 7; i++) {
                        const date = new Date();
                        date.setDate(date.getDate() + i);
                        baseData.predictions.push({
                            date: date.toISOString().split('T')[0],
                            // FIXED: Format all numbers to 1 decimal place
                            temperature: parseFloat((20 + Math.random() * 10).toFixed(1)),
                            precipitation: parseFloat((Math.random() * 10).toFixed(1)),
                            wind_speed: parseFloat((3 + Math.random() * 8).toFixed(1)),
                            max_temperature: parseFloat((22 + Math.random() * 8).toFixed(1)),
                            min_temperature: parseFloat((15 + Math.random() * 5).toFixed(1))
                        });
                    }
                }
                
                return baseData;
            }
            
            displayResults(data, specificDate = null) {
                this.hideLoading();
                this.hideError();
                
                const resultsDiv = document.getElementById('results');
                resultsDiv.style.display = 'block';
                resultsDiv.innerHTML = '';
                
                if (this.settings.ttsMode) {
                    const ttsControls = document.createElement('div');
                    ttsControls.className = 'tts-controls';
                    ttsControls.innerHTML = `
                        <button class="tts-btn" id="readAloudBtn">
                            <i class="fas fa-volume-up"></i> ${this.translate("readAloud")}
                        </button>
                        <button class="tts-btn" id="stopReadingBtn" style="display: none;">
                            <i class="fas fa-stop"></i> ${this.translate("stopReading")}
                        </button>
                    `;
                    resultsDiv.appendChild(ttsControls);
                    
                    document.getElementById('readAloudBtn').addEventListener('click', () => {
                        this.readResultsAloud();
                    });
                    
                    document.getElementById('stopReadingBtn').addEventListener('click', () => {
                        this.stopReadingAloud();
                    });
                }
                
                const header = document.createElement('div');
                header.className = 'results-header';
                header.innerHTML = `
                    <h2><i class="fas fa-satellite"></i> ${this.translate("title")}</h2>
                    <p><i class="fas fa-crosshairs"></i> <strong>${this.translate("coordinates")}:</strong> ${data.location.lat}Â°N, ${data.location.lon}Â°E</p>
                    <p><i class="fas fa-clock"></i> <strong>${this.translate("analysisTime")}:</strong> ${new Date(data.generated_at).toLocaleString()}</p>
                    ${specificDate ? `<p><i class="fas fa-calendar-day"></i> <strong>${this.translate("targetDate")}:</strong> ${specificDate}</p>` : ''}
                `;
                resultsDiv.appendChild(header);
                
                if (specificDate && data.data) {
                    this.displaySpecificDayResults(resultsDiv, data);
                } else {
                    this.displayGeneralForecast(resultsDiv, data);
                }
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'action-buttons';
                actionsDiv.innerHTML = `
                    <button class="action-btn btn-primary" onclick="app.downloadData()">
                        <i class="fas fa-download"></i> ${this.translate("downloadReport")}
                    </button>
                    <button class="action-btn btn-secondary" onclick="app.resetAnalysis()">
                        <i class="fas fa-sync-alt"></i> ${this.translate("newAnalysis")}
                    </button>
                `;
                resultsDiv.appendChild(actionsDiv);
            }
            
            displaySpecificDayResults(container, data) {
                const dayData = data.data.data;
                const isPrediction = data.data.is_prediction;
                const dataType = isPrediction ? 'predicted' : 'historical';
                const userType = document.getElementById('userType').value;
                
                const temp = this.getSafeValue(dayData, ['temperature', 'T2M'], '-');
                const precip = this.getSafeValue(dayData, ['precipitation', 'PRECTOT', 'PRECTOTCORR'], '-');
                const wind = this.getSafeValue(dayData, ['wind_speed', 'WS2M'], '-');
                const humidity = this.getSafeValue(dayData, ['humidity', 'RH2M'], '-');
                const maxTemp = this.getSafeValue(dayData, ['max_temperature', 'T2M_MAX'], '-');
                const minTemp = this.getSafeValue(dayData, ['min_temperature', 'T2M_MIN'], '-');
                
                const dayCard = document.createElement('div');
                dayCard.className = 'specific-day-card';
                dayCard.innerHTML = `
                    <h3><i class="fas fa-calendar-day"></i> ${data.date} Analysis</h3>
                    <p><i class="fas fa-database"></i> ${this.translate("dataType")}: ${dataType} satellite observation</p>
                    
                    <div class="weather-stats">
                        <div class="weather-stat">
                            <i class="${this.weatherIcons.temperature} stat-icon"></i>
                            <div class="stat-value">${temp}${typeof temp === 'number' ? 'Â°C' : ''}</div>
                            <div class="stat-label">${this.translate("temperature")}</div>
                        </div>
                        <div class="weather-stat">
                            <i class="${this.weatherIcons.precipitation} stat-icon"></i>
                            <div class="stat-value">${precip}${typeof precip === 'number' ? 'mm' : ''}</div>
                            <div class="stat-label">${this.translate("precipitation")}</div>
                        </div>
                        <div class="weather-stat">
                            <i class="${this.weatherIcons.wind_speed} stat-icon"></i>
                            <div class="stat-value">${wind}${typeof wind === 'number' ? 'm/s' : ''}</div>
                            <div class="stat-label">${this.translate("windSpeed")}</div>
                        </div>
                        <div class="weather-stat">
                            <i class="${this.weatherIcons.humidity} stat-icon"></i>
                            <div class="stat-value">${humidity}${typeof humidity === 'number' ? '%' : ''}</div>
                            <div class="stat-label">${this.translate("humidity")}</div>
                        </div>
                    </div>
                `;
                container.appendChild(dayCard);
                
                // User-specific suggestions now appear in specific day analysis
                this.displayUserSpecificSuggestions(container, dayData, userType);
                
                if (data.user_advice && data.user_advice.specific_day && data.user_advice.specific_day.length > 0) {
                    const adviceSection = document.createElement('div');
                    adviceSection.className = 'advice-section';
                    adviceSection.innerHTML = '<h3><i class="fas fa-lightbulb"></i> NASA Recommendations</h3>';
                    
                    data.user_advice.specific_day.forEach(advice => {
                        const adviceItem = document.createElement('div');
                        adviceItem.className = 'advice-item';
                        adviceItem.innerHTML = `
                            <span class="advice-icon">ðŸš€</span>
                            <span>${advice}</span>
                        `;
                        adviceSection.appendChild(adviceItem);
                    });
                    
                    container.appendChild(adviceSection);
                }
            }
            
            displayGeneralForecast(container, data) {
                const userType = document.getElementById('userType').value;
                
                if (data.seasonal_forecast && Object.keys(data.seasonal_forecast).length > 0) {
                    const seasonalSection = document.createElement('div');
                    seasonalSection.innerHTML = `<h3><i class="fas fa-chart-line"></i> ${this.translate("seasonalOutlook")}</h3>`;
                    const seasonalGrid = document.createElement('div');
                    seasonalGrid.className = 'seasonal-grid';
                    
                    for (const [season, forecast] of Object.entries(data.seasonal_forecast)) {
                        const card = document.createElement('div');
                        card.className = 'seasonal-card';
                        card.innerHTML = `
                            <h4>${season}</h4>
                            <p><i class="${this.weatherIcons.temperature}"></i> ${this.translate("avgTemp")}: ${this.getSafeValue(forecast, 'avg_temperature')}Â°C</p>
                            <p><i class="${this.weatherIcons.precipitation}"></i> ${this.translate("totalRain")}: ${this.getSafeValue(forecast, 'total_precipitation')}mm</p>
                            <p><i class="fas fa-cloud-rain"></i> ${this.translate("rainyDays")}: ${this.getSafeValue(forecast, 'days_with_rain')}</p>
                            <p><i class="${this.weatherIcons.max_temperature}"></i> ${this.translate("maxTemp")}: ${this.getSafeValue(forecast, 'max_temperature')}Â°C</p>
                            <p><i class="${this.weatherIcons.min_temperature}"></i> ${this.translate("minTemp")}: ${this.getSafeValue(forecast, 'min_temperature')}Â°C</p>
                        `;
                        seasonalGrid.appendChild(card);
                    }
                    
                    seasonalSection.appendChild(seasonalGrid);
                    container.appendChild(seasonalSection);
                }
                
                if (data.predictions && data.predictions.length > 0) {
                    this.displayUserSpecificSuggestions(container, data.predictions[0], userType);
                }
                
                if (data.user_advice) {
                    const adviceSection = document.createElement('div');
                    adviceSection.className = 'advice-section';
                    
                    if (data.user_advice.immediate && data.user_advice.immediate.length > 0) {
                        const immediateDiv = document.createElement('div');
                        immediateDiv.className = 'advice-category';
                        immediateDiv.innerHTML = `<h4><i class="fas fa-bolt"></i> ${this.translate("immediateActions")}</h4>`;
                        
                        data.user_advice.immediate.forEach(advice => {
                            const isWarning = advice.toLowerCase().includes('warning') || 
                                            advice.toLowerCase().includes('risk') || 
                                            advice.toLowerCase().includes('caution');
                            const adviceItem = document.createElement('div');
                            adviceItem.className = `advice-item ${isWarning ? 'warning' : 'info'}`;
                            adviceItem.innerHTML = `
                                <span class="advice-icon">${isWarning ? 'âš ï¸' : 'ðŸ’¡'}</span>
                                <span>${advice}</span>
                            `;
                            immediateDiv.appendChild(adviceItem);
                        });
                        adviceSection.appendChild(immediateDiv);
                    }
                    
                    if (data.user_advice.seasonal && data.user_advice.seasonal.length > 0) {
                        const seasonalDiv = document.createElement('div');
                        seasonalDiv.className = 'advice-category';
                        seasonalDiv.innerHTML = `<h4><i class="fas fa-chart-bar"></i> ${this.translate("seasonalPlanning")}</h4>`;
                        
                        data.user_advice.seasonal.forEach(advice => {
                            const adviceItem = document.createElement('div');
                            adviceItem.className = 'advice-item';
                            adviceItem.innerHTML = `
                                <span class="advice-icon">ðŸ“ˆ</span>
                                <span>${advice}</span>
                            `;
                            seasonalDiv.appendChild(adviceItem);
                        });
                        adviceSection.appendChild(seasonalDiv);
                    }
                    
                    if (adviceSection.children.length > 0) {
                        container.appendChild(adviceSection);
                    }
                }
                
                if (data.predictions && data.predictions.length > 0) {
                    const tableSection = document.createElement('div');
                    tableSection.innerHTML = `<h3><i class="fas fa-table"></i> 7-${this.translate("dayForecast")}</h3>`;
                    
                    const table = document.createElement('table');
                    table.className = 'predictions-table';
                    table.innerHTML = `
                        <thead>
                            <tr>
                                <th>${this.translate("date")}</th>
                                <th><i class="${this.weatherIcons.temperature}"></i> ${this.translate("temperature")} (Â°C)</th>
                                <th><i class="${this.weatherIcons.precipitation}"></i> ${this.translate("rain")} (mm)</th>
                                <th><i class="${this.weatherIcons.wind_speed}"></i> ${this.translate("wind")} (m/s)</th>
                                <th><i class="${this.weatherIcons.max_temperature}"></i> ${this.translate("maxTemp")}</th>
                                <th><i class="${this.weatherIcons.min_temperature}"></i> ${this.translate("minTemp")}</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.predictions.slice(0, 7).map(pred => `
                                <tr>
                                    <td>${pred.date}</td>
                                    <td>${this.getSafeValue(pred, 'temperature')}</td>
                                    <td>${this.getSafeValue(pred, 'precipitation')}</td>
                                    <td>${this.getSafeValue(pred, 'wind_speed')}</td>
                                    <td>${this.getSafeValue(pred, 'max_temperature')}</td>
                                    <td>${this.getSafeValue(pred, 'min_temperature')}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    `;
                    
                    tableSection.appendChild(table);
                    container.appendChild(tableSection);
                }
            }
            
            displayUserSpecificSuggestions(container, weatherData, userType) {
                const suggestions = this.generateUserSpecificSuggestions(weatherData, userType);
                
                if (suggestions.length > 0) {
                    const quickSuggestionsDiv = document.createElement('div');
                    quickSuggestionsDiv.className = 'quick-suggestions';
                    
                    let userTitle = '';
                    switch(userType) {
                        case 'farmer': userTitle = this.translate("farmingRecs"); break;
                        case 'driver': userTitle = this.translate("drivingTips"); break;
                        case 'event_organizer': userTitle = this.translate("eventPlanning"); break;
                        default: userTitle = this.translate("smartRecs");
                    }
                    
                    quickSuggestionsDiv.innerHTML = `
                        <h4><i class="fas fa-rocket"></i> ${userTitle}</h4>
                        <div class="suggestion-items">
                            ${suggestions.map(suggestion => `
                                <div class="suggestion-tag">
                                    <span class="advice-icon">${suggestion.icon}</span>
                                    ${suggestion.text}
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(quickSuggestionsDiv);
                }
                
                if (userType === 'farmer') {
                    this.displayFarmerSpecificInfo(container, weatherData);
                } else if (userType === 'driver') {
                    this.displayDriverSpecificInfo(container, weatherData);
                }
            }
            
            displayFarmerSpecificInfo(container, weatherData) {
                const plantSection = document.createElement('div');
                plantSection.className = 'plant-recommendations';
                plantSection.innerHTML = `<h3><i class="fas fa-seedling"></i> ${this.translate("plantRecommendations")}</h3>`;
                
                const plantCategories = document.createElement('div');
                plantCategories.className = 'plant-categories';
                
                const temp = this.getSafeValue(weatherData, ['temperature', 'T2M'], 20);
                const precip = this.getSafeValue(weatherData, ['precipitation', 'PRECTOT', 'PRECTOTCORR'], 0);
                
                if (temp > 20) {
                    const warmPlantsDiv = document.createElement('div');
                    warmPlantsDiv.className = 'plant-category';
                    warmPlantsDiv.innerHTML = `
                        <h4><i class="fas fa-sun"></i> Warm Weather Crops</h4>
                        <div class="plant-items">
                            <div class="plant-tag"><i class="fas fa-leaf"></i> Maize</div>
                            <div class="plant-tag"><i class="fas fa-leaf"></i> Beans</div>
                            <div class="plant-tag"><i class="fas fa-leaf"></i> Tomatoes</div>
                            <div class="plant-tag"><i class="fas fa-leaf"></i> Peppers</div>
                        </div>
                    `;
                    plantCategories.appendChild(warmPlantsDiv);
                }
                
                if (temp < 20) {
                    const coolPlantsDiv = document.createElement('div');
                    coolPlantsDiv.className = 'plant-category';
                    coolPlantsDiv.innerHTML = `
                        <h4><i class="fas fa-cloud"></i> Cool Weather Crops</h4>
                        <div class="plant-items">
                            <div class="plant-tag"><i class="fas fa-leaf"></i> Cabbage</div>
                            <div class="plant-tag"><i class="fas fa-leaf"></i> Kale</div>
                            <div class="plant-tag"><i class="fas fa-leaf"></i> Carrots</div>
                            <div class="plant-tag"><i class="fas fa-leaf"></i> Potatoes</div>
                        </div>
                    `;
                    plantCategories.appendChild(coolPlantsDiv);
                }
                
                if (precip > 5) {
                    const rainPlantsDiv = document.createElement('div');
                    rainPlantsDiv.className = 'plant-category';
                    rainPlantsDiv.innerHTML = `
                        <h4><i class="fas fa-cloud-rain"></i> Rain-Loving Crops</h4>
                        <div class="plant-items">
                            <div class="plant-tag"><i class="fas fa-leaf"></i> Rice</div>
                            <div class="plant-tag"><i class="fas fa-leaf"></i> Sugarcane</div>
                            <div class="plant-tag"><i class="fas fa-leaf"></i> Bananas</div>
                        </div>
                    `;
                    plantCategories.appendChild(rainPlantsDiv);
                }
                
                plantSection.appendChild(plantCategories);
                container.appendChild(plantSection);
                
                if (this.settings.simplifiedMode) {
                    const probabilitySection = document.createElement('div');
                    probabilitySection.className = 'quick-suggestions';
                    probabilitySection.innerHTML = `
                        <h4><i class="fas fa-chart-pie"></i> ${this.translate("probabilityOfRain")}</h4>
                        <div class="probability-display">
                            <span>Low</span>
                            <div class="probability-bar">
                                <div class="probability-fill" style="width: ${Math.min(precip * 5, 100)}%"></div>
                            </div>
                            <span>High</span>
                        </div>
                        <p style="margin-top: 0.5rem; text-align: center;">
                            ${precip < 2 ? "Low chance of rain today" : 
                              precip < 5 ? "Moderate chance of rain today" : 
                              "High chance of rain today"}
                        </p>
                    `;
                    container.appendChild(probabilitySection);
                }
            }
            
            displayDriverSpecificInfo(container, weatherData) {
                const roadSection = document.createElement('div');
                roadSection.className = 'road-conditions';
                roadSection.innerHTML = `<h3><i class="fas fa-road"></i> ${this.translate("roadConditions")}</h3>`;
                
                const temp = this.getSafeValue(weatherData, ['temperature', 'T2M'], 20);
                const precip = this.getSafeValue(weatherData, ['precipitation', 'PRECTOT', 'PRECTOTCORR'], 0);
                const wind = this.getSafeValue(weatherData, ['wind_speed', 'WS2M'], 0);
                
                const roads = [
                    { name: "Main Highway A1", status: precip > 10 ? "caution" : "open", condition: precip > 10 ? "Wet surface, reduce speed" : "Clear" },
                    { name: "Mountain Pass B5", status: wind > 15 ? "caution" : "open", condition: wind > 15 ? "Strong crosswinds" : "Normal" },
                    { name: "Coastal Road C3", status: "open", condition: "Clear" },
                    { name: "Rural Route D7", status: precip > 5 ? "caution" : "open", condition: precip > 5 ? "Possible mudslides" : "Clear" },
                    { name: "Bridge Crossing E2", status: temp < 3 ? "caution" : "open", condition: temp < 3 ? "Risk of black ice" : "Clear" }
                ];
                
                roads.forEach(road => {
                    const roadItem = document.createElement('div');
                    roadItem.className = 'road-condition-item';
                    roadItem.innerHTML = `
                        <div style="flex: 1;">
                            <strong>${road.name}</strong>
                            <div style="font-size: 0.9rem; color: #b3e5fc;">${road.condition}</div>
                        </div>
                        <div class="road-status ${road.status}">
                            ${road.status === 'open' ? 'OPEN' : road.status === 'caution' ? 'CAUTION' : 'CLOSED'}
                        </div>
                    `;
                    roadSection.appendChild(roadItem);
                });
                
                container.appendChild(roadSection);
            }
            
            generateUserSpecificSuggestions(weatherData, userType) {
                const suggestions = [];
                const temp = this.getSafeValue(weatherData, ['temperature', 'T2M'], 0);
                const precip = this.getSafeValue(weatherData, ['precipitation', 'PRECTOT', 'PRECTOTCORR'], 0);
                const wind = this.getSafeValue(weatherData, ['wind_speed', 'WS2M'], 0);
                const humidity = this.getSafeValue(weatherData, ['humidity', 'RH2M'], 50);
                
                switch(userType) {
                    case 'farmer':
                        if (temp >= 15 && temp <= 30 && precip > 5) {
                            suggestions.push({ icon: 'ðŸŒ±', text: 'Ideal planting conditions' });
                        }
                        if (temp < 5) {
                            suggestions.push({ icon: 'â„ï¸', text: 'Protect crops from frost' });
                        }
                        if (temp > 35) {
                            suggestions.push({ icon: 'ðŸ”¥', text: 'Heat stress risk for crops' });
                        }
                        if (precip > 20) {
                            suggestions.push({ icon: 'ðŸ’§', text: 'Heavy rain - check drainage' });
                        }
                        if (precip < 1 && temp > 25) {
                            suggestions.push({ icon: 'ðŸš°', text: 'Irrigation recommended' });
                        }
                        if (wind > 10) {
                            suggestions.push({ icon: 'ðŸ’¨', text: 'Wind may damage delicate crops' });
                        }
                        break;
                        
                    case 'driver':
                        if (precip > 5) {
                            suggestions.push({ icon: 'ðŸš—', text: 'Reduce speed - wet roads' });
                            suggestions.push({ icon: 'ðŸ“', text: 'Increase following distance' });
                        }
                        if (precip > 10) {
                            suggestions.push({ icon: 'âš ï¸', text: 'Heavy rain - avoid flooded areas' });
                        }
                        if (temp < 3) {
                            suggestions.push({ icon: 'ðŸ§Š', text: 'Watch for black ice' });
                        }
                        if (wind > 15) {
                            suggestions.push({ icon: 'ðŸ’¨', text: 'Strong winds - grip steering firmly' });
                        }
                        if (temp > 35) {
                            suggestions.push({ icon: 'ðŸŒ¡ï¸', text: 'Check vehicle cooling system' });
                        }
                        if (precip > 0 && temp < 3) {
                            suggestions.push({ icon: 'ðŸš«', text: 'Freezing rain possible' });
                        }
                        break;
                        
                    case 'event_organizer':
                        if (precip < 1 && temp >= 18 && temp <= 28) {
                            suggestions.push({ icon: 'âœ…', text: 'Perfect outdoor event weather' });
                        }
                        if (precip > 5) {
                            suggestions.push({ icon: 'ðŸ•ï¸', text: 'Consider indoor venue or tents' });
                        }
                        if (precip > 10) {
                            suggestions.push({ icon: 'ðŸ“…', text: 'Consider rescheduling outdoor event' });
                        }
                        if (temp > 32) {
                            suggestions.push({ icon: 'ðŸ§Š', text: 'Provide extra water and shade' });
                        }
                        if (temp < 10) {
                            suggestions.push({ icon: 'ðŸ”¥', text: 'Consider heating arrangements' });
                        }
                        if (wind > 10) {
                            suggestions.push({ icon: 'ðŸŽª', text: 'Secure tents and decorations' });
                        }
                        break;
                        
                    default:
                        if (temp < 5) {
                            suggestions.push({ icon: 'ðŸ§¥', text: 'Heavy winter jacket needed' });
                            suggestions.push({ icon: 'ðŸ§¤', text: 'Wear thermal gloves' });
                        } else if (temp < 15) {
                            suggestions.push({ icon: 'ðŸ§¥', text: 'Light to medium jacket' });
                        } else if (temp < 25) {
                            suggestions.push({ icon: 'ðŸ‘•', text: 'Light layers comfortable' });
                        } else if (temp > 30) {
                            suggestions.push({ icon: 'ðŸ¥µ', text: 'Light breathable clothing' });
                            suggestions.push({ icon: 'ðŸ’§', text: 'Stay well hydrated' });
                        }
                        
                        if (precip > 10) {
                            suggestions.push({ icon: 'â˜”', text: 'Heavy rain - umbrella essential' });
                            suggestions.push({ icon: 'ðŸ§¥', text: 'Waterproof jacket required' });
                        } else if (precip > 5) {
                            suggestions.push({ icon: 'ðŸŒ‚', text: 'Carry umbrella recommended' });
                        } else if (precip > 0.1) {
                            suggestions.push({ icon: 'ðŸŒ¦ï¸', text: 'Light rain possible' });
                        }
                        
                        if (wind > 15) {
                            suggestions.push({ icon: 'ðŸ’¨', text: 'Very windy - secure outdoor items' });
                        } else if (wind > 8) {
                            suggestions.push({ icon: 'ðŸ’¨', text: 'Breezy conditions' });
                        }
                }
                
                return suggestions.slice(0, 6);
            }
            
            getSafeValue(obj, keys, fallback = '-') {
                if (!obj) return fallback;
                
                const keyArray = Array.isArray(keys) ? keys : [keys];
                
                for (const key of keyArray) {
                    if (obj[key] !== undefined && obj[key] !== null) {
                        // FIXED: Format numbers to 1 decimal place when displaying
                        const value = obj[key];
                        if (typeof value === 'number') {
                            return value.toFixed(1);
                        }
                        return value;
                    }
                }
                
                return fallback;
            }
            
            readResultsAloud() {
                if (!this.settings.ttsMode) return;
                
                const resultsDiv = document.getElementById('results');
                const textToRead = resultsDiv.innerText;
                
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    
                    const speech = new SpeechSynthesisUtterance(textToRead);
                    speech.lang = this.settings.language;
                    speech.rate = 0.9;
                    
                    document.getElementById('readAloudBtn').style.display = 'none';
                    document.getElementById('stopReadingBtn').style.display = 'block';
                    
                    speech.onend = () => {
                        document.getElementById('readAloudBtn').style.display = 'block';
                        document.getElementById('stopReadingBtn').style.display = 'none';
                    };
                    
                    window.speechSynthesis.speak(speech);
                } else {
                    alert('Text-to-speech is not supported in your browser');
                }
            }
            
            stopReadingAloud() {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    document.getElementById('readAloudBtn').style.display = 'block';
                    document.getElementById('stopReadingBtn').style.display = 'none';
                }
            }
            
            downloadData() {
                if (!this.currentData) {
                    alert('No data available to download');
                    return;
                }
                
                const dataStr = JSON.stringify(this.currentData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `nasa_weather_intelligence_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }
            
            resetAnalysis() {
                document.getElementById('results').style.display = 'none';
                document.getElementById('specificDate').value = '';
            }
            
            showLoading(message = 'Initializing satellite link...') {
                document.getElementById('results').style.display = 'none';
                document.getElementById('loading').style.display = 'flex';
                document.getElementById('error').style.display = 'none';
            }
            
            hideLoading() {
                document.getElementById('loading').style.display = 'none';
            }
            
            showError(message) {
                document.getElementById('results').style.display = 'none';
                document.getElementById('errorMessage').textContent = message;
                document.getElementById('error').style.display = 'flex';
                document.getElementById('loading').style.display = 'none';
            }
            
            hideError() {
                document.getElementById('error').style.display = 'none';
            }
        }

        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new NASAWeatherApp();
        });
    </script>
</body>
</html>